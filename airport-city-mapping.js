// Comprehensive airport/city code mapping
const AIRPORT_CITY_MAPPING = {
  // Major Indian cities
  'bengaluru': 'BLR',
  'bangalore': 'BLR',
  'mumbai': 'BOM',
  'bombay': 'BOM',
  'delhi': 'DEL',
  'new delhi': 'DEL',
  'chennai': 'MAA',
  'madras': 'MAA',
  'kolkata': 'CCU',
  'calcutta': 'CCU',
  'hyderabad': 'HYD',
  'pune': 'PNQ',
  'ahmedabad': 'AMD',
  'kochi': 'COK',
  'cochin': 'COK',
  'goa': 'GOI',
  'panaji': 'GOI',
  'jaipur': 'JAI',
  'lucknow': 'LKO',
  'chandigarh': 'IXC',
  'bhubaneswar': 'BBI',
  'thiruvananthapuram': 'TRV',
  'trivandrum': 'TRV',
  'coimbatore': 'CJB',
  'varanasi': 'VNS',
  'benaras': 'VNS',
  'amritsar': 'ATQ',
  'srinagar': 'SXR',
  'guwahati': 'GAU',
  'imphal': 'IMF',
  'agartala': 'IXA',
  'dibrugarh': 'DIB',
  'jorhat': 'JRH',
  'silchar': 'IXS',
  'bagdogra': 'IXB',
  'siliguri': 'IXB',
  'port blair': 'IXZ',
  'udaipur': 'UDR',
  'jodhpur': 'JDH',
  'indore': 'IDR',
  'nagpur': 'NAG',
  'raipur': 'RPR',
  'bhopal': 'BHO',
  'jammu': 'IXJ',
  'leh': 'IXL',
  'dehradun': 'DED',
  'shimla': 'SLV',
  'kullu': 'KUU',
  'dharamshala': 'DHM',

  // Major US cities
  'new york': 'NYC',
  'new york city': 'NYC',
  'nyc': 'NYC',
  'manhattan': 'NYC',
  'brooklyn': 'NYC',
  'los angeles': 'LAX',
  'la': 'LAX',
  'chicago': 'CHI',
  'houston': 'HOU',
  'phoenix': 'PHX',
  'philadelphia': 'PHL',
  'san antonio': 'SAT',
  'san diego': 'SAN',
  'dallas': 'DFW',
  'san jose': 'SJC',
  'austin': 'AUS',
  'jacksonville': 'JAX',
  'fort worth': 'DFW',
  'columbus': 'CMH',
  'indianapolis': 'IND',
  'charlotte': 'CLT',
  'seattle': 'SEA',
  'denver': 'DEN',
  'washington': 'DCA',
  'washington dc': 'DCA',
  'boston': 'BOS',
  'el paso': 'ELP',
  'detroit': 'DTW',
  'nashville': 'BNA',
  'portland': 'PDX',
  'memphis': 'MEM',
  'oklahoma city': 'OKC',
  'las vegas': 'LAS',
  'vegas': 'LAS',
  'louisville': 'SDF',
  'baltimore': 'BWI',
  'milwaukee': 'MKE',
  'albuquerque': 'ABQ',
  'tucson': 'TUS',
  'fresno': 'FAT',
  'sacramento': 'SMF',
  'mesa': 'PHX',
  'kansas city': 'MCI',
  'atlanta': 'ATL',
  'colorado springs': 'COS',
  'raleigh': 'RDU',
  'omaha': 'OMA',
  'miami': 'MIA',
  'oakland': 'OAK',
  'tulsa': 'TUL',
  'cleveland': 'CLE',
  'wichita': 'ICT',
  'arlington': 'DFW',
  'new orleans': 'MSY',
  'bakersfield': 'BFL',
  'tampa': 'TPA',
  'honolulu': 'HNL',
  'anaheim': 'SNA',
  'aurora': 'DEN',
  'santa ana': 'SNA',
  'st. louis': 'STL',
  'riverside': 'PSP',
  'corpus christi': 'CRP',
  'lexington': 'LEX',
  'pittsburgh': 'PIT',
  'anchorage': 'ANC',
  'stockton': 'SCK',
  'cincinnati': 'CVG',
  'st. paul': 'MSP',
  'toledo': 'TOL',
  'newark': 'EWR',
  'greensboro': 'GSO',
  'plano': 'DFW',
  'henderson': 'LAS',
  'lincoln': 'LNK',
  'buffalo': 'BUF',
  'jersey city': 'EWR',
  'chula vista': 'SAN',
  'fort wayne': 'FWA',
  'orlando': 'MCO',
  'st. petersburg': 'PIE',
  'chandler': 'PHX',
  'laredo': 'LRD',
  'norfolk': 'ORF',
  'durham': 'RDU',
  'madison': 'MSN',
  'lubbock': 'LBB',
  'irvine': 'SNA',
  'winston-salem': 'INT',
  'glendale': 'PHX',
  'garland': 'DFW',
  'hialeah': 'MIA',
  'reno': 'RNO',
  'chesapeake': 'ORF',
  'gilbert': 'PHX',
  'baton rouge': 'BTR',
  'irving': 'DFW',
  'scottsdale': 'PHX',
  'north las vegas': 'LAS',
  'fremont': 'SJC',
  'boise': 'BOI',
  'richmond': 'RIC',
  'san bernardino': 'SBD',
  'birmingham': 'BHM',
  'spokane': 'GEG',
  'rochester': 'ROC',
  'des moines': 'DSM',
  'modesto': 'MOD',
  'fayetteville': 'XNA',
  'tacoma': 'SEA',
  'oxnard': 'OXR',
  'fontana': 'SBD',
  'columbus': 'CMH',
  'montgomery': 'MGM',
  'moreno valley': 'PSP',
  'shreveport': 'SHV',
  'aurora': 'DEN',
  'yonkers': 'NYC',
  'akron': 'CAK',
  'huntington beach': 'SNA',
  'little rock': 'LIT',
  'augusta': 'AGS',
  'amarillo': 'AMA',
  'glendale': 'PHX',
  'mobile': 'MOB',
  'grand rapids': 'GRR',
  'salt lake city': 'SLC',
  'tallahassee': 'TLH',
  'huntsville': 'HSV',
  'grand prairie': 'DFW',
  'knoxville': 'TYS',
  'worcester': 'ORH',
  'newport news': 'PHF',
  'brownsville': 'BRO',
  'overland park': 'MCI',
  'santa clarita': 'BUR',
  'providence': 'PVD',
  'garden grove': 'SNA',
  'chattanooga': 'CHA',
  'oceanside': 'SAN',
  'jackson': 'JAN',
  'fort lauderdale': 'FLL',
  'santa rosa': 'STS',
  'rancho cucamonga': 'ONT',
  'port st. lucie': 'PBI',
  'tempe': 'PHX',
  'ontario': 'ONT',
  'vancouver': 'PDX',
  'cape coral': 'RSW',
  'sioux falls': 'FSD',
  'springfield': 'SGF',
  'peoria': 'PIA',
  'pembroke pines': 'FLL',
  'elk grove': 'SMF',
  'rockford': 'RFD',
  'palmdale': 'PMD',
  'corona': 'ONT',
  'salinas': 'SNS',
  'pomona': 'ONT',
  'paterson': 'EWR',
  'joliet': 'MDW',
  'pasadena': 'BUR',
  'torrance': 'LAX',
  'bridgeport': 'BDR',
  'hayward': 'HWD',
  'lakewood': 'LGB',
  'hollywood': 'FLL',
  'sunnyvale': 'SJC',
  'macon': 'MCN',
  'lafayette': 'LFT',
  'thornton': 'DEN',
  'naperville': 'MDW',
  'mesquite': 'DFW',
  'savannah': 'SAV',
  'syracuse': 'SYR',
  'dayton': 'DAY',
  'mcallen': 'MFE',
  'kansas city': 'MCI',
  'hampton': 'PHF',
  'warren': 'DTW',
  'olathe': 'MCI',
  'orange': 'SNA',
  'escondido': 'SAN',
  'fullerton': 'SNA',
  'roseville': 'SMF',
  'cedar rapids': 'CID',
  'bellevue': 'SEA',
  'columbia': 'COU',
  'sterling heights': 'DTW',
  'carrollton': 'DFW',
  'coral springs': 'FLL',
  'stamford': 'HPN',
  'surprise': 'PHX',
  'alexandria': 'DCA',
  'concord': 'SJC',
  'hartford': 'BDL',
  'kent': 'SEA',
  'santa clara': 'SJC',
  'new haven': 'HVN',
  'daly city': 'SFO',
  'allentown': 'ABE',
  'temecula': 'PSP',
  'west valley city': 'SLC',
  'pearland': 'HOU',
  'richardson': 'DFW',
  'ann arbor': 'DTW',
  'berkeley': 'SJC',
  'norman': 'OKC',
  'independence': 'MCI',
  'evansville': 'EVV',
  'lansing': 'LAN',
  'Round Rock': 'AUS',
  'provo': 'PVU',
  'fargo': 'FAR',
  'clearwater': 'PIE',
  'rochester': 'RST',
  'victorville': 'VCV',
  'fairfield': 'SJC',
  'west jordan': 'SLC',
  'inglewoodstockton': 'LAX',
  'richmond': 'SJC',
  'athens': 'AHN',
  'vallejo': 'SJC',
  'el monte': 'LAX',
  'thousand oaks': 'OXR',
  'midland': 'MAF',
  'columbia': 'CAE',
  'cary': 'RDU',
  'topeka': 'TOP',
  'abilene': 'ABI',
  'beaumont': 'BPT',
  'simi valley': 'OXR',
  'odessa': 'MAF',
  'norman': 'OKC',
  'waco': 'ACT',
  'san angelo': 'SJT',
  'vacaville': 'SJC',
  'college station': 'CLL',
  'carlsbad': 'SAN',
  'pueblo': 'PUB',
  'visalia': 'VIS',
  'antioch': 'SJC',
  'manchester': 'MHT',
  'high point': 'GSO',
  'billings': 'BIL',
  'downey': 'LAX',
  'elgin': 'MDW',
  'west palm beach': 'PBI',
  'waterbury': 'BDL',
  'pompano beach': 'FLL',
  'west covina': 'LAX',
  'norwalk': 'LAX',
  'arvada': 'DEN',
  'miami gardens': 'MIA',
  'erie': 'ERI',
  'greeley': 'DEN',
  'centennial': 'DEN',
  'dearborn': 'DTW',
  'gresham': 'PDX',
  'lewisville': 'DFW',
  'murfreesboro': 'BNA',
  'tyler': 'TYR',

  // Major European cities
  'london': 'LON',
  'paris': 'PAR',
  'berlin': 'BER',
  'madrid': 'MAD',
  'rome': 'ROM',
  'amsterdam': 'AMS',
  'vienna': 'VIE',
  'brussels': 'BRU',
  'zurich': 'ZUR',
  'stockholm': 'STO',
  'copenhagen': 'CPH',
  'oslo': 'OSL',
  'helsinki': 'HEL',
  'warsaw': 'WAW',
  'prague': 'PRG',
  'budapest': 'BUD',
  'athens': 'ATH',
  'lisbon': 'LIS',
  'dublin': 'DUB',
  'frankfurt': 'FRA',
  'munich': 'MUC',
  'hamburg': 'HAM',
  'cologne': 'CGN',
  'düsseldorf': 'DUS',
  'stuttgart': 'STR',
  'hannover': 'HAJ',
  'leipzig': 'LEJ',
  'dresden': 'DRS',
  'nuremberg': 'NUE',
  'bremen': 'BRE',
  'dortmund': 'DTM',
  'barcelona': 'BCN',
  'valencia': 'VLC',
  'seville': 'SVQ',
  'bilbao': 'BIO',
  'milan': 'MIL',
  'venice': 'VCE',
  'florence': 'FLR',
  'naples': 'NAP',
  'bologna': 'BLQ',
  'turin': 'TRN',
  'manchester': 'MAN',
  'birmingham': 'BHX',
  'glasgow': 'GLA',
  'edinburgh': 'EDI',
  'liverpool': 'LPL',
  'bristol': 'BRS',
  'newcastle': 'NCL',
  'leeds': 'LBA',
  'marseille': 'MRS',
  'lyon': 'LYS',
  'toulouse': 'TLS',
  'nice': 'NCE',
  'strasbourg': 'SXB',
  'bordeaux': 'BOD',
  'nantes': 'NTE',
  'lille': 'LIL',
  'montpellier': 'MPL',

  // Major Asian cities  
  'tokyo': 'TYO',
  'osaka': 'OSA',
  'kyoto': 'KIX',
  'nagoya': 'NGO',
  'fukuoka': 'FUK',
  'sapporo': 'CTS',
  'hiroshima': 'HIJ',
  'sendai': 'SDJ',
  'beijing': 'PEK',
  'shanghai': 'SHA',
  'guangzhou': 'CAN',
  'shenzhen': 'SZX',
  'chengdu': 'CTU',
  'xi\'an': 'XIY',
  'hangzhou': 'HGH',
  'nanjing': 'NKG',
  'wuhan': 'WUH',
  'tianjin': 'TSN',
  'qingdao': 'TAO',
  'dalian': 'DLC',
  'kunming': 'KMG',
  'seoul': 'SEL',
  'busan': 'PUS',
  'jeju': 'CJU',
  'daegu': 'TAE',
  'incheon': 'ICN',
  'hong kong': 'HKG',
  'macau': 'MFM',
  'taipei': 'TPE',
  'kaohsiung': 'KHH',
  'taichung': 'RMQ',
  'singapore': 'SIN',
  'kuala lumpur': 'KUL',
  'penang': 'PEN',
  'johor bahru': 'JHB',
  'kota kinabalu': 'BKI',
  'kuching': 'KCH',
  'langkawi': 'LGK',
  'bangkok': 'BKK',
  'phuket': 'HKT',
  'chiang mai': 'CNX',
  'koh samui': 'USM',
  'pattaya': 'UTP',
  'krabi': 'KBV',
  'hat yai': 'HDY',
  'ho chi minh city': 'SGN',
  'saigon': 'SGN',
  'hanoi': 'HAN',
  'da nang': 'DAD',
  'nha trang': 'CXR',
  'phu quoc': 'PQC',
  'jakarta': 'CGK',
  'bali': 'DPS',
  'denpasar': 'DPS',
  'yogyakarta': 'JOG',
  'surabaya': 'MLG',
  'medan': 'KNO',
  'bandung': 'BDO',
  'makassar': 'UPG',
  'semarang': 'SRG',
  'palembang': 'PLM',
  'balikpapan': 'BPN',
  'manila': 'MNL',
  'cebu': 'CEB',
  'davao': 'DVO',
  'clark': 'CRK',
  'iloilo': 'ILO',
  'cagayan de oro': 'CGY',
  'zamboanga': 'ZAM',
  'bacolod': 'BCD',
  'tacloban': 'TAC',
  'butuan': 'BXU',

  // Major Australian/NZ cities
  'sydney': 'SYD',
  'melbourne': 'MEL',
  'brisbane': 'BNE',
  'perth': 'PER',
  'adelaide': 'ADL',
  'gold coast': 'OOL',
  'canberra': 'CBR',
  'darwin': 'DRW',
  'hobart': 'HBA',
  'cairns': 'CNS',
  'townsville': 'TSV',
  'alice springs': 'ASP',
  'broome': 'BME',
  'port hedland': 'PHE',
  'karratha': 'KGI',
  'newman': 'ZNE',
  'kalgoorlie': 'KGI',
  'geraldton': 'GET',
  'albany': 'ALH',
  'esperance': 'EPR',
  'kununurra': 'KNX',
  'mt isa': 'ISA',
  'mackay': 'MKY',
  'rockhampton': 'ROK',
  'bundaberg': 'BDB',
  'hervey bay': 'HVB',
  'sunshine coast': 'MCY',
  'toowoomba': 'TWB',
  'ballina': 'BNK',
  'coffs harbour': 'CFS',
  'newcastle': 'NTL',
  'orange': 'OAG',
  'dubbo': 'DBO',
  'tamworth': 'TMW',
  'armidale': 'ARM',
  'wagga wagga': 'WGA',
  'albury': 'ABX',
  'mildura': 'MQL',
  'mount gambier': 'MGB',
  'whyalla': 'WYA',
  'port lincoln': 'PLO',
  'kingscote': 'KGC',
  'launceston': 'LST',
  'devonport': 'DPO',
  'burnie': 'BWT',
  'king island': 'KNS',
  'flinders island': 'FLS',
  'auckland': 'AKL',
  'wellington': 'WLG',
  'christchurch': 'CHC',
  'queenstown': 'ZQN',
  'dunedin': 'DUD',
  'hamilton': 'HLZ',
  'tauranga': 'TRG',
  'rotorua': 'ROT',
  'palmerston north': 'PMR',
  'napier': 'NPE',
  'new plymouth': 'NPL',
  'whangarei': 'WRE',
  'gisborne': 'GIS',
  'invercargill': 'IVC',
  'nelson': 'NSN',
  'blenheim': 'BHE',
  'westport': 'WSZ',
  'hokitika': 'HKK',
  'timaru': 'TIU',
  'oamaru': 'OAM',
  'wanaka': 'WKA',
  'franz josef': 'WHO',

  // Major Middle Eastern cities
  'dubai': 'DXB',
  'abu dhabi': 'AUH',
  'sharjah': 'SHJ',
  'doha': 'DOH',
  'kuwait city': 'KWI',
  'riyadh': 'RUH',
  'jeddah': 'JED',
  'dammam': 'DMM',
  'medina': 'MED',
  'tabuk': 'TUU',
  'abha': 'AHB',
  'muscat': 'MCT',
  'salalah': 'SLL',
  'sohar': 'OHS',
  'nizwa': 'NZW',
  'sur': 'SUH',
  'bahrain': 'BAH',
  'manama': 'BAH',
  'tehran': 'THR',
  'isfahan': 'IFN',
  'shiraz': 'SYZ',
  'mashhad': 'MHD',
  'tabriz': 'TBZ',
  'kermanshah': 'KSH',
  'ahvaz': 'AWZ',
  'arak': 'AJK',
  'yazd': 'AZD',
  'kerman': 'KER',
  'bandar abbas': 'BND',
  'kish': 'KIH',
  'baghdad': 'BGW',
  'basra': 'BSR',
  'erbil': 'EBL',
  'najaf': 'NJF',
  'mosul': 'OSM',
  'sulaymaniyah': 'ISU',
  'damascus': 'DAM',
  'aleppo': 'ALP',
  'lattakia': 'LTK',
  'qamishli': 'KAC',
  'deir ez-zor': 'DEZ',
  'beirut': 'BEY',
  'tripoli': 'KYE',
  'sidon': 'SID',
  'tyre': 'TYR',
  'baalbek': 'BAA',
  'zahle': 'ZHL',
  'amman': 'AMM',
  'aqaba': 'AQJ',
  'irbid': 'IRB',
  'zarqa': 'ZAR',
  'salt': 'SLT',
  'madaba': 'MAD',
  'karak': 'KRK',

  // Major African cities
  'cairo': 'CAI',
  'alexandria': 'ALY',
  'luxor': 'LXR',
  'aswan': 'ASW',
  'hurghada': 'HRG',
  'sharm el sheikh': 'SSH',
  'marsa alam': 'RMF',
  'casablanca': 'CMN',
  'marrakech': 'RAK',
  'fez': 'FEZ',
  'agadir': 'AGA',
  'rabat': 'RBA',
  'tangier': 'TNG',
  'ouarzazate': 'OZZ',
  'essaouira': 'ESU',
  'nador': 'NDR',
  'oujda': 'OUD',
  'al hoceima': 'AHU',
  'tunis': 'TUN',
  'sfax': 'SFA',
  'monastir': 'MIR',
  'djerba': 'DJE',
  'tozeur': 'TOE',
  'gafsa': 'GAF',
  'gabes': 'GAE',
  'algiers': 'ALG',
  'oran': 'ORN',
  'constantine': 'CZL',
  'annaba': 'AAE',
  'batna': 'BLJ',
  'setif': 'QSF',
  'tlemcen': 'TLM',
  'bejaia': 'BJA',
  'ghardaia': 'GHA',
  'ouargla': 'OGX',
  'tamanrasset': 'TMR',
  'in salah': 'INZ',
  'tripoli': 'TIP',
  'benghazi': 'BEN',
  'misrata': 'MRA',
  'sebha': 'SEB',
  'ghat': 'GHT',
  'kufra': 'AKF',
  'sirte': 'SRT',
  'addis ababa': 'ADD',
  'dire dawa': 'DIR',
  'mekelle': 'MQX',
  'bahir dar': 'BJR',
  'gondar': 'GDQ',
  'awasa': 'AWA',
  'jimma': 'JIM',
  'arba minch': 'AMH',
  'axum': 'AXU',
  'lalibela': 'LLI',
  'nairobi': 'NBO',
  'mombasa': 'MBA',
  'kisumu': 'KIS',
  'eldoret': 'EDL',
  'nakuru': 'NUK',
  'malindi': 'MYD',
  'lamu': 'LAU',
  'wajir': 'WJR',
  'garissa': 'GAS',
  'mandera': 'MRE',
  'kampala': 'EBB',
  'entebbe': 'EBB',
  'jinja': 'JIN',
  'mbarara': 'MBQ',
  'gulu': 'ULU',
  'arua': 'RUA',
  'soroti': 'SRT',
  'moroto': 'UOL',
  'kasese': 'KSE',
  'dar es salaam': 'DAR',
  'zanzibar': 'ZNZ',
  'kilimanjaro': 'JRO',
  'mwanza': 'MWZ',
  'arusha': 'ARK',
  'dodoma': 'DOD',
  'tabora': 'TBO',
  'mbeya': 'MBI',
  'songea': 'SGX',
  'musoma': 'MUZ',
  'bukoba': 'BKZ',
  'pemba': 'PMA',
  'tanga': 'TGT',
  'kigoma': 'TKQ',
  'iringa': 'IRI',
  'mtwara': 'MYW',
  'shinyanga': 'SHY',
  'cape town': 'CPT',
  'johannesburg': 'JNB',
  'durban': 'DUR',
  'port elizabeth': 'PLZ',
  'bloemfontein': 'BFN',
  'east london': 'ELS',
  'george': 'GRJ',
  'kimberley': 'KIM',
  'nelspruit': 'MQP',
  'polokwane': 'PTG',
  'upington': 'UTN',
  'pietermaritzburg': 'PZB',
  'richards bay': 'RCB',
  'rustenburg': 'RUH',
  'klerksdorp': 'KXE',
  'witbank': 'WTB',
  'potchefstroom': 'ZUL',
  'vereeniging': 'VER',
  'springs': 'SPR',
  'benoni': 'BEN',
  'boksburg': 'BOK',
  'germiston': 'GER',
  'soweto': 'JNB',
  'pretoria': 'WDH',
  'centurion': 'CEN',
  'sandton': 'SAN',
  'randburg': 'RAN',
  'roodepoort': 'ROO',
  'midrand': 'MID',
  'kempton park': 'KEM',
  'vanderbijlpark': 'VAN',
  'carletonville': 'CAR',
  'krugersdorp': 'KRU',
  'westonaria': 'WES',
  'randfontein': 'RAN',
  'alberton': 'ALB',
  'edenvale': 'EDE',
  'bedfordview': 'BED',
  'brakpan': 'BRA',
  'nigel': 'NIG',
  'heidelberg': 'HEI',
  'katlehong': 'KAT',
  'tembisa': 'TEM',
  'daveyton': 'DAV',
  'duduza': 'DUD',
  'kwa-thema': 'KWA',
  'tokoza': 'TOK',
  'vosloorus': 'VOS',
  'thokoza': 'THO',
  'casablanca': 'CMN',

  // Major South American cities
  'sao paulo': 'SAO',
  'rio de janeiro': 'RIO',
  'brasilia': 'BSB',
  'salvador': 'SSA',
  'fortaleza': 'FOR',
  'belo horizonte': 'CNF',
  'manaus': 'MAO',
  'curitiba': 'CWB',
  'recife': 'REC',
  'porto alegre': 'POA',
  'belem': 'BEL',
  'goiania': 'GYN',
  'campinas': 'VCP',
  'sao luis': 'SLZ',
  'sao goncalo': 'GIG',
  'maceio': 'MCZ',
  'duque de caxias': 'GIG',
  'teresina': 'THE',
  'natal': 'NAT',
  'campo grande': 'CGR',
  'nova iguacu': 'GIG',
  'sao bernardo do campo': 'SAO',
  'joao pessoa': 'JPA',
  'santo andre': 'SAO',
  'osasco': 'SAO',
  'jaboatao dos guararapes': 'REC',
  'sao jose dos campos': 'SJK',
  'ribeirao preto': 'RAO',
  'uberlandia': 'UDI',
  'contagem': 'CNF',
  'sorocaba': 'SOD',
  'aracaju': 'AJU',
  'feira de santana': 'FEN',
  'cuiaba': 'CGB',
  'joinville': 'JOI',
  'juiz de fora': 'JDF',
  'londrina': 'LDB',
  'aparecida de goiania': 'GYN',
  'porto velho': 'PVH',
  'serra': 'VIX',
  'niteroi': 'SDU',
  'campos dos goytacazes': 'CAW',
  'caxias do sul': 'CXJ',
  'macapa': 'MCP',
  'vila velha': 'VIX',
  'florianopolis': 'FLN',
  'sao joao de meriti': 'GIG',
  'santos': 'SSZ',
  'mogi das cruzes': 'SAO',
  'diadema': 'SAO',
  'betim': 'CNF',
  'jundiai': 'JDI',
  'campina grande': 'CPV',
  'piracicaba': 'QCP',
  'caraguatatuba': 'CAG',
  'montes claros': 'MOC',
  'boa vista': 'BVB',
  'carapicuiba': 'SAO',
  'olinda': 'REC',
  'suzano': 'SAO',
  'taubate': 'QTA',
  'guaruja': 'GRU',
  'sao vicente': 'SSZ',
  'novo hamburgo': 'NHB',
  'bauru': 'BAU',
  'sao carlos': 'QSC',
  'paulista': 'REC',
  'rio branco': 'RBR',
  'anapolis': 'APS',
  'blumenau': 'BNU',
  'guarulhos': 'GRU',
  'sao jose do rio preto': 'SJP',
  'pelotas': 'PET',
  'canoas': 'QCA',
  'maracanau': 'FOR',
  'volta redonda': 'VDC',
  'franca': 'FRC',
  'uberaba': 'UBA',
  'foz do iguacu': 'IGU',
  'limeira': 'LIP',
  'suzano': 'SAO',
  'peoria': 'PEO',
  'rio claro': 'QRC',
  'americana': 'AMR',
  'araxa': 'AAX',
  'presidente prudente': 'PPB',
  'araraquara': 'AQA',
  'santa maria': 'RIA',
  'marilia': 'MII',
  'dourados': 'DOU',
  'sete lagoas': 'SET',
  'itaquaquecetuba': 'SAO',
  'sumare': 'SMA',
  'governador valadares': 'GVR',
  'volta redonda': 'VDC',
  'rio grande': 'RIG',
  'cachoeirinha': 'QCA',
  'gravataí': 'QGR',
  'embu': 'EMB',
  'sao caetano do sul': 'SAO',
  'indaiatuba': 'QID',
  'cotia': 'COT',
  'embu das artes': 'EMB',
  'taboao da serra': 'TAB',
  'hortolândia': 'HTO',
  'santa luzia': 'CNF',
  'camaçari': 'SSA',
  'canindé': 'CAN',
  'sobral': 'SOB',
  'arapiraca': 'APL',
  'mossoró': 'MVF',
  'vitória': 'VIX',
  'petrolina': 'PNZ',
  'juazeiro': 'JZI',
  'ilhéus': 'IOS',
  'imperatriz': 'IMP',
  'parauapebas': 'CKS',
  'castanhal': 'CAS',
  'santarém': 'STM',
  'marabá': 'MAB',
  'altamira': 'ATM',
  'tucuruí': 'TUR',
  'redenção': 'RDC',
  'paragominas': 'PGM',
  'bragança': 'BRG',
  'capitão poço': 'CPO',
  'abaetetuba': 'ATB',
  'cametá': 'CMT',
  'itaituba': 'ITB',
  'oriximiná': 'ORX',
  'monte alegre': 'MTE',
  'óbidos': 'OBD',
  'santana': 'SAT',
  'laranjal do jari': 'LJR',
  'oiapoque': 'OYK',
  'buenos aires': 'BUE',
  'cordoba': 'COR',
  'rosario': 'ROS',
  'mendoza': 'MDZ',
  'tucuman': 'TUC',
  'la plata': 'LPG',
  'mar del plata': 'MDQ',
  'salta': 'SLA',
  'santa fe': 'SFN',
  'san juan': 'UAQ',
  'resistencia': 'RES',
  'santiago del estero': 'SDE',
  'corrientes': 'CNQ',
  'posadas': 'PSS',
  'bahia blanca': 'BHI',
  'parana': 'PRA',
  'formosa': 'FMA',
  'san luis': 'LUQ',
  'comodoro rivadavia': 'CRD',
  'neuquen': 'NQN',
  'rio gallegos': 'RGL',
  'ushuaia': 'USH',
  'jujuy': 'JUJ',
  'catamarca': 'CTC',
  'la rioja': 'IRJ',
  'san salvador de jujuy': 'JUJ',
  'santiago': 'SCL',
  'valparaiso': 'VAP',
  'concepcion': 'CCP',
  'antofagasta': 'ANF',
  'vina del mar': 'VAP',
  'valdivia': 'ZAL',
  'rancagua': 'QRC',
  'arica': 'ARI',
  'iquique': 'IQQ',
  'puerto montt': 'PMC',
  'chillan': 'YAI',
  'curico': 'QRC',
  'osorno': 'ZOS',
  'calama': 'CJC',
  'copiapo': 'CPO',
  'la serena': 'LSC',
  'temuco': 'ZCO',
  'talca': 'TLC',
  'punta arenas': 'PUQ',
  'lima': 'LIM',
  'arequipa': 'AQP',
  'trujillo': 'TRU',
  'chiclayo': 'CIX',
  'piura': 'PIU',
  'iquitos': 'IQT',
  'cusco': 'CUZ',
  'cuzco': 'CUZ',
  'huancayo': 'HUU',
  'pucallpa': 'PCL',
  'chimbote': 'CHM',
  'tacna': 'TCQ',
  'ica': 'ICA',
  'sullana': 'SYC',
  'ayacucho': 'AYP',
  'cajamarca': 'CJA',
  'puno': 'JUL',
  'tumbes': 'TBP',
  'tarapoto': 'TPP',
  'huaraz': 'ATA',
  'tingo maria': 'TGI',
  'jaen': 'JAE',
  'moyobamba': 'MBP',
  'yurimaguas': 'YMS',
  'puerto maldonado': 'PEM',
  'quito': 'UIO',
  'guayaquil': 'GYE',
  'cuenca': 'CUE',
  'machala': 'MCH',
  'manta': 'MEC',
  'portoviejo': 'PVO',
  'ambato': 'ATF',
  'riobamba': 'RIO',
  'loja': 'LOH',
  'esmeraldas': 'ESM',
  'ibarra': 'IBB',
  'santo domingo': 'STD',
  'milagro': 'MIL',
  'quevedo': 'QUE',
  'babahoyo': 'BBA',
  'tulcan': 'TUA',
  'nueva loja': 'LGQ',
  'macas': 'XMS',
  'tena': 'TNW',
  'puyo': 'PYO',
  'zamora': 'ZAM',
  'gualaquiza': 'GUA',
  'sucua': 'SUC',
  'mendez': 'MEN',
  'morona': 'MOR',
  'taisha': 'TSH',
  'santiago': 'STG',
  'san cristobal': 'SCY',
  'baltra': 'GPS',
  'caracas': 'CCS',
  'maracaibo': 'MAR',
  'valencia': 'VLN',
  'barquisimeto': 'BRM',
  'maracay': 'MYC',
  'ciudad guayana': 'CGU',
  'san cristobal': 'SCI',
  'cumana': 'CUM',
  'merida': 'MRD',
  'barcelona': 'BLA',
  'punto fijo': 'LSP',
  'puerto la cruz': 'PLC',
  'los teques': 'LTQ',
  'guarenas': 'GUA',
  'petare': 'PET',
  'turmero': 'TRM',
  'acarigua': 'AGV',
  'araure': 'AAR',
  'carora': 'COR',
  'barinas': 'BNS',
  'valera': 'VLR',
  'trujillo': 'TRJ',
  'san fernando': 'SFD',
  'guanare': 'GDO',
  'la victoria': 'LVC',
  'villa de cura': 'VDC',
  'san felipe': 'SFE',
  'puerto cabello': 'PBL',
  'morón': 'MRN',
  'cagua': 'CGA',
  'bogota': 'BOG',
  'medellin': 'MDE',
  'cali': 'CLO',
  'barranquilla': 'BAQ',
  'cartagena': 'CTG',
  'cucuta': 'CUC',
  'soledad': 'SOL',
  'ibague': 'IBE',
  'bucaramanga': 'BGA',
  'soacha': 'SOA',
  'pereira': 'PEI',
  'santa marta': 'SMR',
  'villavicencio': 'VVC',
  'valledupar': 'VUP',
  'monteria': 'MTR',
  'manizales': 'MZL',
  'neiva': 'NVA',
  'palmira': 'PLM',
  'popayan': 'PPN',
  'pasto': 'PSO',
  'sincelejo': 'SIN',
  'florencia': 'FLA',
  'riohacha': 'RCH',
  'buenaventura': 'BUN',
  'tunja': 'TUA',
  'duitama': 'DUI',
  'sogamoso': 'SOG',
  'armenia': 'AXM',
  'quibdo': 'UIB',
  'yopal': 'EYP',
  'mocoa': 'MCA',
  'san andres': 'ADZ',
  'providencia': 'PVA',
  'leticia': 'LET',
  'puerto carreno': 'PCR',
  'inirida': 'PDA',
  'mitu': 'MVP',

  // Major Canadian cities
  'toronto': 'YYZ',
  'montreal': 'YUL',
  'vancouver': 'YVR',
  'calgary': 'YYC',
  'edmonton': 'YEG',
  'ottawa': 'YOW',
  'winnipeg': 'YWG',
  'quebec city': 'YQB',
  'hamilton': 'YHM',
  'kitchener': 'YKF',
  'london': 'YXU',
  'st. catharines': 'YCM',
  'halifax': 'YHZ',
  'oshawa': 'YOO',
  'victoria': 'YYJ',
  'windsor': 'YQG',
  'saskatoon': 'YXE',
  'regina': 'YQR',
  'sherbrooke': 'YSC',
  'kelowna': 'YKA',
  'barrie': 'YBR',
  'abbotsford': 'YXX',
  'sudbury': 'YSB',
  'kingston': 'YGK',
  'saguenay': 'YBG',
  'trois-rivières': 'YRQ',
  'guelph': 'YGU',
  'thunder bay': 'YQT',
  'moncton': 'YQM',
  'brantford': 'YBF',
  'saint john': 'YSJ',
  'peterborough': 'YPQ',
  'kamloops': 'YKA',
  'white rock': 'YDT',
  'nanaimo': 'YCD',
  'prince george': 'YXS',
  'sault ste. marie': 'YAM',
  'sarnia': 'YZR',
  'red deer': 'YQF',
  'lethbridge': 'YQL',
  'medicine hat': 'YXH',
  'grande prairie': 'YQU',
  'airdrie': 'YAA',
  'halton hills': 'YHH',
  'saint-jean-sur-richelieu': 'YJN',
  'dollar-des ormeaux': 'YDO',
  'drummondville': 'YDQ',
  'fort mcmurray': 'YMM',
  'granby': 'YGO',
  'sherwood park': 'YSP',
  'charlottetown': 'YYG',
  'fredericton': 'YFC',
  'north bay': 'YYB',
  'saint-hyacinthe': 'YHY',
  'joliette': 'YJE',
  'brandon': 'YBR',
  'chilliwack': 'YCW',
  'chatham-kent': 'YCK',
  'yorkton': 'YYN',
  'saint-jérôme': 'YJR',
  'new westminster': 'YNW',
  'whitehorse': 'YXY',
  'welland': 'YWD',
  'north vancouver': 'YNV',
  'vernon': 'YVE',
  'charlottetown': 'YYG',
  'campbell river': 'YBL',
  'rimouski': 'YXK',
  'cornwall': 'YCC',
  'stouffville': 'YSF',
  'georgina': 'YGI',
  'lacombe': 'YLC',
  'port alberni': 'YPB',
  'moose jaw': 'YMJ',
  'sorel-tracy': 'YSO',
  'coldwater': 'YCW',
  'new glasgow': 'YZG',
  'amherst': 'YAH',
  'fort saint john': 'YXJ',
  'brooks': 'YBK',
  'corner brook': 'YCR',
  'cranbrook': 'YXC',
  'swift current': 'YYN',
  'yorkton': 'YYN',
  'lloydminster': 'YLL',
  'estevan': 'YEN',
  'weyburn': 'YWE',
  'portage la prairie': 'YPG',
  'selkirk': 'YSK',
  'steinbach': 'YST',
  'thompson': 'YTH',
  'the pas': 'YQD',
  'flin flon': 'YFO',
  'churchill': 'YYQ',
  'iqaluit': 'YFB',
  'yellowknife': 'YZF',
  'inuvik': 'YEV',
  'hay river': 'YHY',
  'fort smith': 'YSM',
  'rankin inlet': 'YRT',
  'baker lake': 'YBK',
  'resolute': 'YRB',
  'pond inlet': 'YIO',
  'pangnirtung': 'YXP',
  'cape dorset': 'YTE',
  'igloolik': 'YGT',
  'arviat': 'YEK',
  'chesterfield inlet': 'YCS',
  'repulse bay': 'YUT',
  'taloyoak': 'YYH',
  'kugluktuk': 'YCO',
  'cambridge bay': 'YCB',
  'gjoa haven': 'YHK',

  // Additional airport codes that might be commonly used
  'jfk': 'JFK',
  'lax': 'LAX',
  'lhr': 'LHR',
  'cdg': 'CDG',
  'nrt': 'NRT',
  'dxb': 'DXB',
  'sin': 'SIN',
  'fra': 'FRA',
  'ams': 'AMS',
  'mad': 'MAD',
  'bcn': 'BCN',
  'fco': 'FCO',
  'muc': 'MUC',
  'vie': 'VIE',
  'zurich': 'ZUR',
  'geneva': 'GVA',
  'brussels': 'BRU',
  'oslo': 'OSL',
  'stockholm': 'ARN',
  'copenhagen': 'CPH',
  'helsinki': 'HEL'
};

// Function to resolve city name to airport code
function resolveAirportCode(cityInput) {
  if (!cityInput) return null;
  
  // Clean and normalize the input
  const cleanInput = cityInput.toLowerCase()
    .trim()
    .replace(/[,\s]+.*$/, '') // Remove everything after comma or multiple spaces
    .replace(/[^\w\s]/g, '') // Remove special characters except word chars and spaces
    .replace(/\s+/g, ' ') // Normalize multiple spaces to single space
    .trim();
  
  // Direct lookup
  if (AIRPORT_CITY_MAPPING[cleanInput]) {
    return AIRPORT_CITY_MAPPING[cleanInput];
  }
  
  // Try partial matches
  for (const [city, code] of Object.entries(AIRPORT_CITY_MAPPING)) {
    if (city.includes(cleanInput) || cleanInput.includes(city)) {
      return code;
    }
  }
  
  // If input is already 3 letter code, return as is
  if (/^[A-Z]{3}$/i.test(cleanInput)) {
    return cleanInput.toUpperCase();
  }
  
  // Last resort: try first 3 letters (old method)
  return cleanInput.toUpperCase().substring(0, 3);
}

// Function to get city suggestions based on partial input
function getCitySuggestions(partialInput, maxSuggestions = 5) {
  if (!partialInput || partialInput.length < 2) return [];
  
  const cleanInput = partialInput.toLowerCase().trim();
  const suggestions = [];
  
  for (const [city, code] of Object.entries(AIRPORT_CITY_MAPPING)) {
    if (city.startsWith(cleanInput) || city.includes(cleanInput)) {
      suggestions.push({
        city: city.charAt(0).toUpperCase() + city.slice(1),
        code: code,
        display: `${city.charAt(0).toUpperCase() + city.slice(1)} (${code})`
      });
      
      if (suggestions.length >= maxSuggestions) break;
    }
  }
  
  return suggestions;
}

module.exports = {
  AIRPORT_CITY_MAPPING,
  resolveAirportCode,
  getCitySuggestions
};